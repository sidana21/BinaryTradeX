# 🔐 دليل متغيرات البيئة (Environment Variables)

## ما هي متغيرات البيئة؟
متغيرات البيئة هي إعدادات سرية أو خاصة بالتطبيق لا يتم حفظها في الكود. مثل كلمات المرور ومفاتيح API.

---

## 📋 المتغيرات المطلوبة

### 1️⃣ `SESSION_SECRET` (إلزامي في الإنتاج)
**الوصف:** مفتاح سري لحماية جلسات المستخدمين (login sessions)

**القيمة المطلوبة:**
- نص عشوائي طويل (32 حرف على الأقل)
- يجب أن يكون صعب التخمين وفريد

**كيفية التوليد:**
```bash
# استخدم هذا الأمر لتوليد مفتاح عشوائي آمن:
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

**مثال:**
```
SESSION_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

⚠️ **مهم جداً:** لا تستخدم القيمة الافتراضية في الإنتاج!

---

### 2️⃣ `NODE_ENV` (مهم للأداء والأمان)
**الوصف:** يحدد بيئة التشغيل (تطوير أو إنتاج)

**القيم الممكنة:**
- `development` - للتطوير المحلي (على Replit)
- `production` - للإنتاج (على Render)

**على Render:**
```
NODE_ENV=production
```

**الفرق:**
- `production`: أسرع، أكثر أماناً، يستخدم ملفات مبنية (compiled)
- `development`: أبطأ، يعيد التحميل تلقائياً، أدوات تطوير متاحة

---

### 3️⃣ `PORT` (اختياري - يتم تعيينه تلقائياً)
**الوصف:** المنفذ الذي يعمل عليه التطبيق

**لا تحتاج لتعيينه:**
- على Replit: يستخدم 5000 تلقائياً ✅
- على Render: يستخدم ما توفره Render (10000 عادة) ✅

⚠️ **ملاحظة:** الكود يكتشف المنفذ الصحيح تلقائياً، لا تغيره!

---

## 🔧 متغيرات اختيارية

### 4️⃣ `BINOMO_AUTHTOKEN` (اختياري)
**الوصف:** مفتاح API للاتصال بحساب Binomo الحقيقي

**متى تحتاجه:**
- فقط إذا كنت تريد التداول الحقيقي عبر Binomo API
- غير مطلوب للتداول التجريبي (Demo Trading)

**كيفية الحصول عليه:**
1. سجل دخول إلى Binomo
2. افتح أدوات المطور في المتصفح (F12)
3. ابحث عن `authtoken` في مكالمات API

⚠️ **تحذير:** لا تشارك هذا المفتاح مع أي شخص!

---

### 5️⃣ `BINOMO_DEVICE_ID` (اختياري)
**الوصف:** معرّف الجهاز لـ Binomo API

**متى تحتاجه:**
- يأتي مع `BINOMO_AUTHTOKEN`
- غير مطلوب للتداول التجريبي

---

### 6️⃣ `DATABASE_URL` (اختياري)
**الوصف:** رابط الاتصال بقاعدة بيانات PostgreSQL

**متى تحتاجه:**
- إذا أضفت PostgreSQL على Render
- Render يعيّنه تلقائياً عند إضافة Database

**شكل الرابط:**
```
postgresql://username:password@host:port/database_name
```

⚠️ **ملاحظة:** التطبيق الحالي يستخدم In-Memory Storage (لا يحتاج قاعدة بيانات)

---

## 📝 كيفية إضافة المتغيرات

### على Render:

1. افتح لوحة تحكم Render
2. اختر Web Service الخاص بك
3. اذهب إلى **Environment** في القائمة الجانبية
4. اضغط **Add Environment Variable**
5. أضف كل متغير:

| المفتاح (Key) | القيمة (Value) |
|---------------|----------------|
| `NODE_ENV` | `production` |
| `SESSION_SECRET` | `[مفتاح عشوائي طويل - استخدم الأمر أعلاه]` |

6. احفظ التغييرات
7. سيتم إعادة تشغيل التطبيق تلقائياً

---

### على Replit:

1. افتح Replit Editor
2. اضغط على أيقونة **القفل** 🔒 في الشريط الجانبي (Secrets)
3. أضف المتغيرات:
   - **Key:** `SESSION_SECRET`
   - **Value:** `[مفتاح عشوائي طويل]`

4. احفظ

---

## ✅ قائمة التحقق النهائية

قبل النشر على Render، تأكد من:

- [x] إضافة `SESSION_SECRET` بقيمة عشوائية قوية
- [x] تعيين `NODE_ENV` إلى `production`
- [x] **لا تضيف** `PORT` (سيتم تعيينه تلقائياً)
- [ ] (اختياري) إضافة `BINOMO_AUTHTOKEN` و `BINOMO_DEVICE_ID` للتداول الحقيقي

---

## 🚨 أخطاء شائعة

### خطأ: "Cookie not secure"
**السبب:** `NODE_ENV` ليس `production` على Render

**الحل:**
```
NODE_ENV=production
```

---

### خطأ: "Session expired immediately"
**السبب:** `SESSION_SECRET` متغير بين عمليات إعادة التشغيل

**الحل:**
تأكد من إضافة `SESSION_SECRET` في متغيرات البيئة، وليس في الكود!

---

### خطأ: "Port already in use"
**السبب:** حاولت تحديد `PORT` يدوياً

**الحل:**
احذف متغير `PORT` ودع Render يختار المنفذ تلقائياً

---

## 🔒 الأمان

### ⚠️ لا تفعل أبداً:
- ❌ لا تحفظ `SESSION_SECRET` في الكود
- ❌ لا تشارك متغيرات البيئة على GitHub
- ❌ لا تستخدم مفاتيح ضعيفة مثل "123456" أو "password"

### ✅ افعل دائماً:
- ✅ استخدم Secrets/Environment Variables
- ✅ ولّد مفاتيح عشوائية طويلة
- ✅ غيّر المفاتيح إذا تم كشفها

---

## 📞 الدعم

إذا واجهت مشاكل:
1. تحقق من سجلات Render (Logs)
2. تأكد من كتابة أسماء المتغيرات بشكل صحيح (case-sensitive)
3. أعد تشغيل التطبيق بعد إضافة المتغيرات
